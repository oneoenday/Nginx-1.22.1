name: Nginx-1.22.1
on: [push]
jobs:
  Explore-GitHub-Actions:
    runs-on: ubuntu-latest
    container: docker.io/centos:7
    steps:
      - uses: actions/checkout@v3

      - name: install dependent
        run: |
          yum install -y rpm-build openssl-devel zlib-devel pcre2-devel
          
      - name: create user and switch
        run: |
          useradd -m -p test_pass macros
          echo "%_topdir /home/macros/rpmbuid" >/home/macros/.rpmmacros
          su macros

      - name: create rpmbuid
        run: |
          mkdir -p /github/home/rpmbuild

      - name: prep sources
        run: |
          mv /__w/Nginx-1.22.1/Nginx-1.22.1/SPECS /github/home/rpmbuild/
          mv /__w/Nginx-1.22.1/Nginx-1.22.1/SOURCES /github/home/rpmbuild/


      - name: make
        run: |
          cd /github/home/rpmbuild/SPECS
          su macros
          rpmbuild -bb nginx.spec
